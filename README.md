Telegram-бот случайных сообщений с весами (aiogram)

Это Telegram-бот для групп, написанный на Python с использованием aiogram 3.
Бот отслеживает сообщения в групповых чатах и периодически отправляет случайное сообщение или стикер на основе реальной частоты активности пользователей.

Чем чаще пользователи отправляют одно и то же сообщение или стикер, тем выше вероятность того, что бот отправит именно его.

⸻

Возможности
	•	Работает в группах и супергруппах
	•	Считывает все сообщения пользователей (текст и стикеры)
	•	Автоматически отправляет сообщение каждые N сообщений пользователей
	•	Взвешенный случайный выбор:
	•	Сообщения, встречающиеся чаще, имеют более высокий шанс выбора
	•	Может отправлять как текстовые сообщения, так и стикеры
	•	Хранит данные не более 7 дней (автоматическая очистка)
	•	Настройки отдельно для каждого чата
	•	Полное JSON-логирование (в терминал и файл)
	•	Безопасная очистка базы данных с подтверждением одноразовым паролем

⸻

Принцип работы
	1.	Пользователи общаются в группе в обычном режиме.
	2.	Бот сохраняет:
	•	Текстовые сообщения
	•	file_id стикеров
	3.	После каждых N сообщений (настраивается) бот:
	•	Случайным образом выбирает между текстом и стикером
	•	Отправляет один элемент с учётом весовой вероятности
	4.	Старые сообщения (старше 7 дней) автоматически удаляются.
	5.	При первой активности после перезапуска бот отправляет приветственное сообщение (настраивается).

⸻

Требования
	•	Python 3.10+
	•	aiogram 3
	•	aiosqlite
	•	python-dotenv (если используется .env для токена)

⸻

Примечания
	•	Бот должен быть администратором группы, чтобы читать сообщения.
	•	SQLite подходит для малых и средних чатов.
	•	Для высокой нагрузки рекомендуется PostgreSQL.
	•	Токен следует хранить в переменных окружения и исключать из Git.

⸻

Команды
	•	/setfrequency n — устанавливает количество сообщений пользователей, после которых бот автоматически отправляет сообщение или стикер (настройка для конкретного чата)
	•	/sendtext — принудительно отправляет текстовое сообщение с использованием взвешенного случайного выбора из сохранённых сообщений
	•	/sendsticker — принудительно отправляет стикер из сохранённых стикеров
	•	/cleardb — полностью очищает базу данных бота; требует подтверждения одноразовым 8-значным паролем, который выводится в терминал хоста и должен быть отправлен пользователем в ответ для подтверждения удаления